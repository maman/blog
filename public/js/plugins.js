// usage: log('inside coolFunc', this, arguments);
// paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/
window.log = function f(){ log.history = log.history || []; log.history.push(arguments); if(this.console) { var args = arguments, newarr; args.callee = args.callee.caller; newarr = [].slice.call(args); if (typeof console.log === 'object') log.apply.call(console.log, console, newarr); else console.log.apply(console, newarr);}};

// make it safe to use console.log always
(function(a){function b(){}for(var c="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),d;!!(d=c.pop());){a[d]=a[d]||b;}})
(function(){try{console.log();return window.console;}catch(a){return (window.console={});}}());


// place any jQuery/helper plugins in here, instead of separate, slower script files.
// PJAX
(function(e){function t(t,n,r){r=o(n,r);var i=t.currentTarget;if(i.tagName.toUpperCase()!=="A")throw"$.fn.pjax or $.pjax.click requires an anchor element";if(t.which>1||t.metaKey||t.ctrlKey)return;if(location.protocol!==i.protocol||location.host!==i.host)return;if(i.hash&&i.href.replace(i.hash,"")===location.href.replace(location.hash,""))return;if(i.href===location.href+"#")return;var s={url:i.href,container:e(i).attr("data-pjax"),target:i,clickedElement:e(i),fragment:null};e.pjax(e.extend({},s,r));t.preventDefault()}function r(){return(new Date).getTime()}function i(e){return e.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function s(e){var t=document.createElement("a");t.href=e;return t}function o(t,n){if(t&&n)n.container=t;else if(e.isPlainObject(t))n=t;else n={container:t};if(n.container)n.container=u(n.container);return n}function u(t){t=e(t);if(!t.length){throw"no pjax container for "+t.selector}else if(t.selector!==""&&t.context===document){return t}else if(t.attr("id")){return e("#"+t.attr("id"))}else{throw"cant get selector for pjax container!"}}function a(t,n){var r=e();t.each(function(){if(e(this).is(n))r=r.add(this);r=r.add(n,this)});return r}function f(t,n,r){var s={};s.url=i(n.getResponseHeader("X-PJAX-URL")||r.requestUrl);var o=e(t);if(o.length===0)return s;s.title=a(o,"title").last().text();if(r.fragment){var u=a(o,r.fragment).first();if(u.length){s.contents=u.contents();if(!s.title)s.title=u.attr("title")||u.data("title")}}else if(!/<html/i.test(t)){s.contents=o}if(s.contents){s.contents=s.contents.not("title");s.contents.find("title").remove()}if(s.title)s.title=s.title.trim();return s}function p(e,t){l[e]=t;h.push(e);while(c.length)delete l[c.shift()];while(h.length>n.defaults.maxCacheLength)delete l[h.shift()]}function d(e,t,n){var r,i;l[t]=n;if(e==="forward"){r=h;i=c}else{r=c;i=h}r.push(t);if(t=i.pop())delete l[t]}e.noop=function(){};e.fn.pjax=function(e,n,r){return this.on("click.pjax",e,function(e){t(e,n,r)})};var n=e.pjax=function(t){function v(t,n){console.log(" type ",t);var r=e.Event(t,{relatedTarget:i});d.trigger(r,n);if(r.isDefaultPrevented){return!r.isDefaultPrevented()}return!r.defaultPrevented}function E(e,n){if(m)clearTimeout(m);if(l)l.apply(this,arguments);v("pjax:complete",[e,n,t]);v("pjax:end",[e,t]);v("end.pjax",[e,t])}function S(i,u,a){var l=f(i,a,t);if(!l.contents){window.location=l.url;return}n.state={id:t.id||r(),url:l.url,title:l.title,container:d.selector,fragment:t.fragment,timeout:t.timeout,direction:t.direction,duration:t.duration};if(t.push||t.replace){window.history.replaceState(n.state,l.title,l.url)}if(l.title)document.title=l.title;d.html(l.contents);if(typeof t.scrollTo==="number"&&e.scrollTop)e(window).scrollTop(t.scrollTo);if((t.replace||t.push)&&window._gaq)_gaq.push(["_trackPageview"]);if(o!==""){var h=s(l.url);h.hash=o;n.state.url=h.href;window.history.replaceState(n.state,l.title,h.href);var p=e(h.hash);if(p.length)e(window).scrollTop(p.offset().top)}if(c)c.apply(this,arguments);v("pjax:success",[i,u,a,t])}t=e.extend({},e.ajaxSettings,n.defaults,t);if(e.isFunction(t.url)){t.url=t.url()}var i=t.target;if(!i&&t.clickedElement)i=t.clickedElement[0];var o=s(t.url).hash;var a=t.beforeSend,l=t.complete,c=t.success,h=t.error;var d=t.context=u(t.container);if(!t.data)t.data={};t.data._pjax=d.selector;var m,g;var y,b,w;t.beforeSend=function(e,r){var i=r.timeout;if(r.timeout>0){m=setTimeout(function(){if(v("pjax:timeout",[e,t]))e.abort("timeout")},r.timeout);r.timeout=0}if(r.type!=="GET"){r.timeout=0}e.setRequestHeader("X-PJAX","true");e.setRequestHeader("X-PJAX-Container",d.selector);if(!v("pjax:beforeSend",[e,r]))return false;var o=r.duration;if(m&&o>=i)o=i-1;if(o>=0&&o!=null){g=setTimeout(function(){g=null;if(b){if(y)y();if(w)w();b();return}v("pjax:waiting",[e,t])},o)}if(t.push&&!t.replace){p(n.state.id,d.clone(true,true).contents());window.history.pushState(null,"",t.url)}t.requestUrl=s(r.url).href;v("pjax:start",[e,t]);v("start.pjax",[e,t]);v("pjax:send",[e,r])};t.complete=function(e,n){b=function(){E.call(t,e,n)};if(!g)b()};t.error=function(e,n,r){console.log("error");var i=f("",e,t);if(h)h.apply(this,arguments);var s=v("pjax:error",[e,n,r,t]);if(n!=="abort"&&s)window.location=i.url};t.success=function(e,t,n,r){y=function(){S.call(r,e,t,n)};if(!g)y()};if(!n.state){n.state={id:r(),url:window.location.href,title:document.title,container:d.selector,fragment:t.fragment,timeout:t.timeout,direction:t.direction};window.history.replaceState(n.state,document.title)}var x=n.xhr;if(x&&x.readyState<4){x.onreadystatechange=e.noop;x.abort()}n.options=t;n.xhr=e.ajax(t);e(document).trigger("pjax",[n.xhr,t]);return n.xhr};n.reload=function(t,n){console.log("pjax reload");var r={url:window.location.href,push:false,replace:true,scrollTo:false};return e.pjax(e.extend(r,o(t,n)))};n.defaults={timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20};var l={};var c=[];var h=[];n.click=t;e(window).bind("popstate",function(t){console.log("popstate args ",arguments);var r=t.state;if(r&&r.container){var i=e(r.container);if(i.length){var s=l[r.id];if(n.state){var o=n.options.direction=n.state.id<r.id?"forward":"back";d(o,n.state.id,i.clone().contents())}var u=e.Event("pjax:popstate",{state:r,direction:o});i.trigger(u);var a={id:r.id,url:r.url,container:i,push:false,fragment:r.fragment,timeout:r.timeout,scrollTo:false,direction:o,duration:r.duration};if(s){console.log(r);e(document).trigger("pjax",[null,a]);i.trigger("pjax:start",[null,a]);setTimeout(function(){if(r.title)document.title=r.title;i.html(s);n.state=r;i.trigger("pjax:end",[null,a]);i[0].offsetHeight},r.duration||0)}else{e.pjax(a)}i[0].offsetHeight}else{window.location=location.href}}});e.support={};e.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);if(!e.support.pjax){e.pjax=function(t){var n=e.isFunction(t.url)?t.url():t.url,r=t.type?t.type.toUpperCase():"GET";var i=e("<form>",{method:r==="GET"?"GET":"POST",action:n,style:"display:none"});if(r!=="GET"&&r!=="POST"){i.append(e("<input>",{type:"hidden",name:"_method",value:r.toLowerCase()}))}var s=t.data;if(typeof s==="string"){e.each(s.split("&"),function(t,n){var r=n.split("=");i.append(e("<input>",{type:"hidden",name:r[0],value:r[1]}))})}else if(typeof s==="object"){for(key in s)i.append(e("<input>",{type:"hidden",name:key,value:s[key]}))}e(document.body).append(i);i.submit()};e.pjax.click=e.noop;e.pjax.reload=window.location.reload;e.fn.pjax=function(){return this}}})(Zepto||jQuery);
// ZProgress
(function(e){function o(){if(n)return;e("body").append(t);n=e("#zprogress");r=e("#zprogress_indicator")}function u(){r.animate({translateX:i*100+"%"},200)}function a(){if(s)clearTimeout(s);s=undefined}function f(){s=setTimeout(function(){e.zprogress.inc((.85-i)*.035*Math.random());f()},350+400*Math.random())}var t="<style>#zprogress{position:fixed;top:0;left:0;width:100%;height:3px;opacity:0;pointer-events:none;-webkit-pointer-events:none;z-index:1000}"+"#zprogress_indicator{width:100%;margin-left:-100%;height:100%;background:#F00}"+"</style>"+"<div id=zprogress><div id=zprogress_indicator></div></div>",n,r,i,s;e.zprogress={start:function(){o();a();i=.1;n.animate({opacity:1});r.animate({translateX:"0%"},0);u();f()},inc:function(e){if(i<.85)i+=e||.05;u()},set:function(e){o();a();i=e;u();f()},done:function(){o();a();i=1;u();setTimeout(function(){n.animate({opacity:0})},100)},color:function(e){o();r.css({backgroundColor:e})}}})(Zepto);
// Smooth Scroll
(function(e){var t={endY:e.os.android?1:0,duration:200,updateRate:15};var n=function(e,t,n){return e+(t-e)*n};var r=function(e){return-Math.cos(e*Math.PI)/2+.5};var i=function(i){var s=e.extend({},t,i);if(s.duration===0){window.scrollTo(0,s.endY);if(typeof s.callback==="function")s.callback();return}var o=window.pageYOffset,u=Date.now(),a=u+s.duration;var f=function(){var e=Date.now(),t=e>a?1:(e-u)/s.duration;window.scrollTo(0,n(o,s.endY,r(t)));if(e<a){setTimeout(f,s.updateRate)}else{if(typeof s.callback==="function")s.callback()}};f()};var s=function(i){var s=e.extend({},t,i);if(s.duration===0){this.scrollTop=s.endY;if(typeof s.callback==="function")s.callback();return}var o=this.scrollTop,u=Date.now(),a=u+s.duration,f=this;var l=function(){var e=Date.now(),t=e>a?1:(e-u)/s.duration;f.scrollTop=n(o,s.endY,r(t));if(e<a){setTimeout(l,s.updateRate)}else{if(typeof s.callback==="function")s.callback()}};l()};e.scrollTo=i;e.fn.scrollTo=function(){if(this.length){var e=arguments;this.forEach(function(t,n){s.apply(t,e)})}}})(Zepto);